export default {
    data() {
        return {
            jobs: [{"JobID":649372,"CompanyName":"大连斯锐信息技术有限公司","JobTitle":"前端开发工程师（外包）-金融公司","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":647422,"CompanyName":"上海宝仕利股权投资合伙企业(有限合伙)","JobTitle":"前端工程师","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":646234,"CompanyName":"寓见资产管理(上海)有限公司","JobTitle":"前端开发工程师","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":644703,"CompanyName":"上海科技发展有限公司","JobTitle":"高级工程师（前端）","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":644688,"CompanyName":"上海科汇人才服务有限公司","JobTitle":"高级工程师（前端）","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":642194,"CompanyName":"上海韦晴软件科技有限公司","JobTitle":"高级前端开发工程师","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":642021,"CompanyName":"上海阿雷夫科技有限公司","JobTitle":"高级前端工程师","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":641962,"CompanyName":"taocai-推慕二办09","JobTitle":"急聘高级前端开发工程师/H5开发","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":641725,"CompanyName":"taocai-推慕二办09","JobTitle":"高级前端开发+15薪+各种福利补贴","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":641719,"CompanyName":"taocai-推慕二办09","JobTitle":"急聘高级前端开发（智能医疗行业）","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":639506,"CompanyName":"taocai-推慕二办09","JobTitle":"诚聘前端开发工程师+周末双休+15薪","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":639353,"CompanyName":"taocai-推慕二办09","JobTitle":"急聘高级前端开发+15薪","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":639338,"CompanyName":"taocai-推慕二办09","JobTitle":"急聘前端开发工程师+15薪","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":610003,"CompanyName":"上海微盟企业发展有限公司","JobTitle":"前端工程师（SASS）","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":531728,"CompanyName":"虎扑(上海)文化传播股份有限公司","JobTitle":"高级前端研发工程师(虎扑）","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":450425,"CompanyName":"上海仁童电子科技有限公司","JobTitle":"高级前端开发工程师","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":444341,"CompanyName":"上海复旦微电子股份有限公司","JobTitle":"高级数字前端验证工程师","AnnualSalaryMax":48,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":423458,"CompanyName":"杭州优灿科技有限公司上海分公司","JobTitle":"带队前端开发工程师","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":421646,"CompanyName":"成都小蜜蜂人力资源服务有限公司","JobTitle":"前端催收客服（包住宿+六险一金）","AnnualSalaryMax":36,"AnnualSalaryMin":24,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":2,"isGettingDetail":false},{"JobID":3375907,"CompanyName":"国外知名互联网公司 ","JobTitle":"前端开发工程师","AnnualSalaryMax":35,"AnnualSalaryMin":18,"PublishDate":"2019-01-25","keywords":null,"Responsibility":"__vue_devtool_undefined__","ReferrerType":1,"isGettingDetail":false}],
            activeName: -1,
            hasMore: false,
            pagenation: {
                pageIndex: 1
                // pageSize: 5 对方接口该参数无效
            },
            isLoading: false
        };
    },
    methods: {
        getJobs(param) {
            if(this.isLoading) {
                return ;
            }
            this.isLoading = true;
            this.jsonRequest.post("/search", param).then(res => {
                this.isLoading = false;
                const data = res.data;
                if (data.code === "000000") {
                    this.jobs = this.jobs.concat(
                        data.body.JobList.map(job => ({
                            JobID: job.JobID,
                            CompanyName: job.CompanyName,
                            JobTitle: job.JobTitle,
                            AnnualSalaryMax: job.AnnualSalaryMax,
                            AnnualSalaryMin: job.AnnualSalaryMin,
                            PublishDate: job.PublishDate,
                            keywords: null,
                            Responsibility: job.Responsibility,
                            ReferrerType: job.ReferrerType,
                            isGettingDetail: false
                        }))
                    );
                    this.hasMore =
                        data.body.PageCount > this.pagenation.pageIndex;
                }
            });
        },
        getDetail(job) {
            if (job.isGettingDetail) {
                return;
            }
            job.isGettingDetail = true;
            this.formRequest
                .get(`/detail?referrerType=${job.ReferrerType}&id=${job.JobID}`)
                .then(res => {
                    job.isGettingDetail = false;
                    const data = res.data;
                    if (data.code === "000000") {
                        job.Responsibility = data.body.Responsibility;
                        job.keywords = this.parseResponseTxt(
                            job.Responsibility
                        );
                    }
                });
        },
        onCollapseChange(index) {
            const job = this.jobs[index];
            if (job && !job.Responsibility) {
                this.getDetail(job);
            }
        },
        parseResponseTxt(sentence) {
            var requires = ['精通','熟练','熟悉','掌握'];
            let keywords = [];
            for(let i=0;i<requires.length;i++) {
                let reg = new RegExp(`${requires[i]}\\s?([\u4e00-\u9fa5a-zA-Z0-9、\/]+)`,'gi');
                let txt = sentence.match(reg);
                if(txt&&txt.length) {
                    keywords = txt.map(i => i.match(/([a-zA-z]\w+)/g)).reduce((pre, cur) => {
                        return cur ? pre.concat(cur) : pre;
                    }, [])
                    if(keywords&&keywords.length) {
                        break;
                    }
                } else {
                    continue;
                }
            }
            return keywords;
        }
    }
}